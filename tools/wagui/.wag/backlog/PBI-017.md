# PBI-017: User Notes Panel (Sidebar Section)

## User Story
As a developer, I want a notes section in the sidebar where I can jot down thoughts while Claude is working so that I don't forget ideas that come to me mid-task.

## Problem
When Claude is busy executing a long task, the user often thinks of:
- Follow-up questions to ask
- Additional features to request
- Things to remember to mention

By the time Claude finishes, these thoughts are forgotten.

## Acceptance Criteria
- [ ] "Notes" section in the left sidebar
- [ ] Section is expandable/collapsible (uses SidebarSection from PBI-016)
- [ ] Notes are scoped per-app (each app has its own notes)
- [ ] Notes persist to SQLite across sessions
- [ ] Each note has: text input + completed checkbox
- [ ] Can add new notes quickly (Enter to add)
- [ ] Can check off completed notes (strikethrough)
- [ ] Can delete notes (hover to reveal delete button)
- [ ] Works in both expanded and collapsed sidebar states
- [ ] Tests written for new code

## Technical Notes

### Database Schema
```sql
CREATE TABLE notes (
    id TEXT PRIMARY KEY,
    app TEXT NOT NULL,
    content TEXT NOT NULL,
    completed INTEGER DEFAULT 0,
    created_at INTEGER NOT NULL,
    updated_at INTEGER NOT NULL
);

CREATE INDEX idx_notes_app ON notes(app);
```

### Server Actions
```typescript
'use server'

import { db } from './db'

export async function createNote(app: string, content: string): Promise<Note> {
    const id = crypto.randomUUID()
    const now = Date.now()
    db.run(
        'INSERT INTO notes (id, app, content, completed, created_at, updated_at) VALUES (?, ?, ?, 0, ?, ?)',
        [id, app, content, now, now]
    )
    return { id, app, content, completed: false, createdAt: now, updatedAt: now }
}

export async function updateNote(id: string, updates: { content?: string, completed?: boolean }): Promise<void> {
    const sets: string[] = ['updated_at = ?']
    const values: any[] = [Date.now()]

    if (updates.content !== undefined) {
        sets.push('content = ?')
        values.push(updates.content)
    }
    if (updates.completed !== undefined) {
        sets.push('completed = ?')
        values.push(updates.completed ? 1 : 0)
    }

    values.push(id)
    db.run(`UPDATE notes SET ${sets.join(', ')} WHERE id = ?`, values)
}

export async function deleteNote(id: string): Promise<void> {
    db.run('DELETE FROM notes WHERE id = ?', [id])
}

export async function fetchNotes(app: string): Promise<Note[]> {
    return db.all('SELECT * FROM notes WHERE app = ? ORDER BY created_at DESC', [app])
}
```

### Component Structure
```
src/components/Sidebar/
‚îú‚îÄ‚îÄ NotesSection.tsx      # The sidebar section wrapper
‚îú‚îÄ‚îÄ NoteList.tsx          # List of notes
‚îú‚îÄ‚îÄ NoteItem.tsx          # Individual note (checkbox, text, delete)
‚îî‚îÄ‚îÄ NoteInput.tsx         # Input for adding new notes
```

### UI in Sidebar

**Expanded:**
```
‚îÇ ‚ñº Notes              ‚îÇ
‚îÇ   ‚òê Ask about cache  ‚îÇ
‚îÇ   ‚òë Dark mode idea   ‚îÇ
‚îÇ   ‚òê Review errors    ‚îÇ
‚îÇ   [+ Add note...]    ‚îÇ
```

**Collapsed (icon only):**
```
‚îÇ üìù ‚îÇ  ‚Üê Click opens popover or tooltip showing notes
```

### Interactions
- **Add note:** Type in input at bottom, press Enter
- **Complete note:** Click checkbox ‚Üí toggle, strikethrough text
- **Delete note:** Hover reveals `√ó` button on right
- **Collapsed mode:** Click üìù icon shows popover with notes list

## UI Requirements

### Visual Design
- Checkbox aligned left
- Note text truncates with ellipsis if too long
- Completed notes: muted color, strikethrough
- Delete button appears on hover (subtle `√ó`)
- Input has placeholder "Add note..."

### Keyboard
- `Enter` in input ‚Üí add note, clear input
- `Escape` in input ‚Üí blur

## Priority
P2 - Quality of life improvement

## Dependencies
- PBI-016 (Collapsible Left Sidebar Shell) - provides the section structure
- PBI-001 (SQLite Persistence) - storage infrastructure

## Estimate
Small - straightforward CRUD, fits into existing sidebar structure
