# PBI-019: Smart Content Rendering

## User Story
As a developer, I want wagui to render message content intelligently based on its type so that markdown, code, diffs, and JSON are displayed with appropriate formatting.

## Problem
Currently all messages are rendered as plain text. This means:
- Markdown formatting shows raw `**bold**` and `# headers`
- Code has no syntax highlighting
- JSON is hard to read without structure
- Diffs don't show +/- coloring

## Acceptance Criteria
- [ ] Messages with markdown render with proper formatting
- [ ] Code blocks have syntax highlighting
- [ ] JSON content shows as collapsible tree view
- [ ] Diff content shows with +/- line coloring
- [ ] Plain text renders as-is (no processing)
- [ ] URLs auto-linkify in all content types
- [ ] Content type can be explicitly set via `contentType` field
- [ ] Auto-detection works when `contentType` not specified
- [ ] Tests written for new code

## Technical Notes

### Content Types
```typescript
type ContentType = 'markdown' | 'text' | 'diff' | 'json' | 'code'

interface WagMessage {
    // ... existing fields
    contentType?: ContentType
    language?: string  // For code blocks: 'typescript', 'python', etc.
}
```

### Auto-Detection Logic
```typescript
function detectContentType(content: string): ContentType {
    // Check for JSON
    if (/^\s*[\[{]/.test(content)) {
        try {
            JSON.parse(content)
            return 'json'
        } catch {}
    }

    // Check for diff
    if (/^(@@|\+\+\+|---|\+[^+]|-[^-])/m.test(content))
        return 'diff'

    // Check for markdown indicators
    if (/^#{1,6}\s|^\*\*|^\- \[|```|^\|.*\|$/m.test(content))
        return 'markdown'

    return 'text'
}
```

### Rendering Components
```typescript
// ContentRenderer.tsx
function ContentRenderer({ content, contentType, language }: Props) {
    const type = contentType ?? detectContentType(content)

    switch (type) {
        case 'markdown':
            return <MarkdownRenderer content={content} />
        case 'json':
            return <JsonTreeViewer content={content} />
        case 'diff':
            return <DiffViewer content={content} />
        case 'code':
            return <CodeBlock content={content} language={language} />
        case 'text':
        default:
            return <PlainText content={content} />
    }
}
```

### Dependencies
```bash
# Markdown rendering
pnpm add react-markdown remark-gfm

# Syntax highlighting
pnpm add shiki
# or
pnpm add prism-react-renderer

# JSON tree view
pnpm add react-json-view-lite
# or build simple collapsible tree

# Diff rendering
pnpm add react-diff-viewer-continued
# or simple CSS-based approach
```

### wag-mcp Changes
Update `wag_send_message` to accept optional `contentType` and `language`:
```typescript
wag_send_message(
    role: "dev",
    type: "diff",
    content: "...",
    contentType: "diff",  // NEW
    file: "src/foo.ts"
)
```

## UI Requirements

### Markdown
- Headers styled appropriately (h1-h6)
- Code blocks with syntax highlighting
- Tables render as actual tables
- Lists (ordered/unordered) with proper indentation
- Links clickable

### JSON
- Collapsible nodes for objects/arrays
- Syntax coloring for keys, strings, numbers, booleans
- Copy button (optional)

### Diff
- Green background for added lines (+)
- Red background for removed lines (-)
- Line numbers (optional)
- Monospace font

### Code
- Syntax highlighting based on language
- Line numbers (optional)
- Copy button (optional)

## Priority
P2 - Enhances readability significantly

## Dependencies
None - works with current message structure

## Estimate
Medium - multiple renderers, auto-detection logic
