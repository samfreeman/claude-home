# PBI-027: Transcript-Based Conversation Capture

## Status

**Superseded by PBI-029** - Chose polling over hooks approach. PBI-029 covers the same problem with better interruption detection.

## User Story

As a user, I want wagui to display the actual conversation (user messages, Claude responses) so I can see meaningful discussion instead of tool call noise.

## Problem

Currently wagui shows every tool call as a context divider (Running, Reading, Writing, etc.). The actual conversation - what the user asked, what Claude replied - is missing entirely. The feed is useless for understanding what happened.

## Solution

Use Claude Code hooks to capture the real conversation from the transcript file:

1. `UserPromptSubmit` hook - Captures user message immediately when submitted
2. `Stop` hook - Captures Claude's complete response when finished

The transcript file (JSONL) at `transcript_path` contains all messages. Parse it and send to wagui.

## Supersedes

**PBI-025** - Instead of filtering tool call noise, we capture the real conversation. PBI-025 becomes irrelevant.

## Acceptance Criteria

- [ ] `UserPromptSubmit` hook sends user messages to wagui
- [ ] `Stop` hook sends Claude responses to wagui
- [ ] Messages appear in wagui feed with correct roles (user/assistant)
- [ ] Hook scripts are in wagui repo (can be symlinked to ~/.claude/hooks/)
- [ ] Documentation for hook setup
- [ ] Tests written for transcript parsing logic

## Technical Notes

### Hook Input

All hooks receive JSON with `transcript_path`:
```json
{
  "session_id": "abc123",
  "transcript_path": "/home/samf/.claude/projects/.../session.jsonl"
}
```

### Transcript Format (JSONL)

```jsonl
{"type":"user","content":"Fix the overflow","timestamp":"..."}
{"type":"assistant","content":[{"type":"text","text":"I'll update..."}],"model":"..."}
```

### Blocking Behavior

Hooks block briefly (before/after Claude thinks), not during. Acceptable latency.

### No Streaming

No hook fires during Claude's response - we get complete responses only. Acceptable tradeoff.

## Priority

P1 - Makes wagui actually useful

## Dependencies

None

## Estimate

Medium - hooks, transcript parsing, wagui integration