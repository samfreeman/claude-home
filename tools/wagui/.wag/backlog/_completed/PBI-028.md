# PBI-028: App Registry & Selection

## User Story

As a user, I want wagui to track known apps and let me switch between them so that the UI shows the right context for whatever app I'm working on.

## Problem

Currently wagui doesn't persistently track which apps exist or their paths. When I switch between apps (either via UI or CLI), the system needs to know:
- App name (display)
- App root path (to derive transcript location)
- Repo root path (for git operations, may differ in monorepo)

## Solution

Add an apps registry to the server that:
1. Stores app details when first encountered via `wag_set_state`
2. Provides API for UI to list and select apps
3. Supports bidirectional sync - CLI or UI can change active app

## Acceptance Criteria

- [x] `apps` table in SQLite: name, app_root, repo_root, last_used
- [x] `wag_set_state` expanded with `appRoot` and `repo` parameters
- [x] Calling `wag_set_state` upserts into apps table
- [x] `GET /api/v1/apps` returns list of known apps
- [x] `POST /api/v1/select` switches active app by name
- [x] Selecting app broadcasts state change to UI via SSE
- [x] wag-mcp tool definition updated for new parameters
- [x] wagu command updated to pass appRoot/repo
- [x] Tests written for new functionality

## Technical Notes

### Database Schema

```sql
CREATE TABLE apps (
    name TEXT PRIMARY KEY,
    app_root TEXT NOT NULL,
    repo_root TEXT,
    last_used INTEGER NOT NULL
)
```

### API Endpoints

**GET /api/v1/apps**
```json
{
  "success": true,
  "apps": [
    { "name": "samx", "appRoot": "...", "repoRoot": "...", "lastUsed": 1234567890 },
    { "name": "wagui", "appRoot": "...", "repoRoot": "...", "lastUsed": 1234567880 }
  ]
}
```

**POST /api/v1/select**
```json
{ "app": "wagui" }
```
Response: Same as wag_get_state

### wag_set_state Changes

```typescript
{
  app: string,           // required
  appRoot: string,       // NEW - required
  repo?: string,         // NEW - optional, defaults to appRoot
  mode: WagMode,
  branch?: string,
  context: string,
  pbi?: string,
  task?: number,
  totalTasks?: number
}
```

## Priority

P0 - Foundation for transcript-based display

## Dependencies

None

## Estimate

Medium
