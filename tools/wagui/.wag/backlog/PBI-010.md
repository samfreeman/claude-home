# PBI-010: Two-Way Communication via File-Based Command Queue

## User Story
As a developer, I want to send commands to Claude Code from the wagui interface so that I can approve, reject, or control the workflow without switching windows.

## Problem
Currently communication is one-way:
- Claude Code → wag-mcp → wagui (display only)

Users must switch to the terminal/VS Code to interact with Claude Code.

## Acceptance Criteria
- [ ] wagui can send commands to Claude Code via file-based queue
- [ ] Approve/Reject buttons in wagui for diff reviews
- [ ] Commands processed within ~1 second
- [ ] Command history visible in wagui
- [ ] Tests written for new code

## Proposed Solution

### Architecture
```
wagui                     wag-mcp                    Claude Code
┌─────────┐              ┌─────────┐               ┌─────────┐
│ Button  │──POST───────►│ Queue   │◄──MCP call───│ Check   │
│ clicked │              │ command │               │ & exec  │
└─────────┘              └─────────┘               └─────────┘
```

### Implementation

**1. wag-mcp: Add command queue**
```typescript
// New file: .wag/commands/pending.json
// Or in-memory with SSE broadcast

interface PendingCommand {
    id: string
    command: 'approve' | 'reject' | 'continue' | 'stop' | 'custom'
    payload?: string
    timestamp: number
}
```

**2. wag-mcp: New MCP tool**
```typescript
wag_check_commands(): PendingCommand[]
// Returns and clears pending commands
```

**3. wagui: Command buttons**
- Approve button (for diff reviews)
- Reject button (for diff reviews)
- Stop button (interrupt current operation)
- Optional: text input for custom commands

**4. wagu.md: Integrate command checking**
- After `wag_send_message()`, also call `wag_check_commands()`
- Or piggyback: every wag call returns pending commands

### Alternative: Piggyback on existing calls
Instead of separate `wag_check_commands()`, modify existing tools to return pending commands:
```typescript
wag_send_message(...) → { success, message, pendingCommands: [] }
```

## UI Mockup
```
┌─────────────────────────────────────┐
│ [Approve] [Reject] [Stop]           │  ← Command bar
├─────────────────────────────────────┤
│                                     │
│  Chat messages...                   │
│                                     │
└─────────────────────────────────────┘
```

## Priority
P3 - Nice to have. Current workflow (switching windows) works fine.

## Dependencies
- None (but enhances overall WAGU experience)

## Estimate
Medium - changes to wag-mcp, wagui, and wagu.md

## Future Considerations
- Could expand to full terminal embedding (xterm.js + node-pty)
- Could add custom prompt input
- Could add command history/replay
