# PBI-011: Source Control Panel in wagui

## User Story
As a developer, I want to see git status and changes in wagui so that I can track what code is being modified without switching to my IDE.

## Problem
Currently wagui shows workflow messages but provides no visibility into:
- Which repository is being worked on
- What files have changed
- Current branch status
- Staged vs unstaged changes
- Which file is currently being modified

Users must switch to VS Code or terminal to see git status.

## Acceptance Criteria
- [ ] wagui displays the target repository path/name
- [ ] Current branch is visible
- [ ] Changed files are listed (staged, unstaged, untracked)
- [ ] Currently active file is highlighted (file being edited now)
- [ ] Status updates in real-time via SSE
- [ ] Collapsible panel (doesn't dominate the UI)
- [ ] Tests written for new code

## Proposed Solution

### Architecture
```
wag-mcp                              wagui
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ git status      â”‚â”€â”€â”€SSE eventâ”€â”€â”€â”€â–ºâ”‚ Source Control  â”‚
â”‚ watcher/polling â”‚                 â”‚ Panel           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Data Model
```typescript
interface GitStatus {
    repo: string           // e.g., "wagui" or full path
    branch: string         // e.g., "dev"
    staged: string[]       // Files staged for commit
    modified: string[]     // Modified but not staged
    untracked: string[]    // New files not tracked
    ahead: number          // Commits ahead of remote
    behind: number         // Commits behind remote
    activeFile?: string    // File currently being edited
}
```

### Active File Tracking
When Claude Code sends messages with file metadata (proposals, diffs), the `file` field should be used to highlight the active file in the Source Control panel:

```typescript
// In wag_send_message
wag_send_message({
    role: 'dev',
    type: 'diff',
    content: '...',
    file: 'src/components/Chat.tsx'  // â† This updates activeFile
})
```

### Implementation Options

**Option A: Piggyback on state**
- Include git status in `wag_set_state()` calls
- Architect/Dev sends git info when entering mode
- Low overhead, but only updates on mode changes

**Option B: Dedicated MCP tool**
- New `wag_git_status()` tool
- Called periodically by Claude Code
- More control, but requires explicit calls

**Option C: Server-side polling**
- wag-mcp watches git directory for changes
- Broadcasts updates automatically
- Real-time, but more complex

### UI Mockup
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“ wagui (dev)              [^]     â”‚  â† Collapsible header
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Modified (2)                        â”‚
â”‚ â–¶ M src/components/Chat.tsx         â”‚  â† Active file highlighted
â”‚   M src/hooks/useSSE.ts             â”‚
â”‚ Untracked (1)                       â”‚
â”‚   ? src/components/GitPanel.tsx     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Priority
P3 - Nice to have. Users can check git status in terminal/IDE.

## Dependencies
- None (but complements PBI-010 two-way communication)

## Estimate
Medium - new component, SSE event type, data flow

## Future Considerations
- Click to view diff in wagui
- Stage/unstage from wagui (requires PBI-010)
- Commit from wagui (requires PBI-010)
