# PBI-020: HTML Content Rendering

## User Story
As a developer, I want wagui to render HTML content so that I can display rich formatted output, tables, and styled content in messages.

## Problem
Some content is best expressed as HTML - complex tables, styled output, or formatted reports. Currently this would render as raw HTML tags.

## Acceptance Criteria
- [ ] Messages with `contentType: 'html'` render as HTML
- [ ] HTML is sanitized with DOMPurify to prevent XSS
- [ ] Basic HTML tags work: div, span, p, table, ul, ol, strong, em, etc.
- [ ] Inline styles work (within sanitization limits)
- [ ] Scripts and event handlers are stripped (security)
- [ ] Auto-detection does NOT detect HTML (must be explicit)
- [ ] Tests written for new code

## Technical Notes

### Why Explicit Only (No Auto-Detection)
HTML detection is tricky and risky:
- False positives: `<thinking>` or `5 < 10` could trigger
- Security: auto-rendering HTML opens more attack surface
- Intent: if someone wants HTML, they should say so

### Implementation
```typescript
// Add to ContentType
type ContentType = 'markdown' | 'text' | 'diff' | 'json' | 'code' | 'html'

// HtmlRenderer.tsx
import DOMPurify from 'dompurify'

function HtmlRenderer({ content }: { content: string }) {
    const sanitized = DOMPurify.sanitize(content, {
        ALLOWED_TAGS: [
            'div', 'span', 'p', 'br', 'hr',
            'h1', 'h2', 'h3', 'h4', 'h5', 'h6',
            'strong', 'em', 'b', 'i', 'u', 's',
            'ul', 'ol', 'li',
            'table', 'thead', 'tbody', 'tr', 'th', 'td',
            'a', 'img',
            'pre', 'code',
            'blockquote'
        ],
        ALLOWED_ATTR: [
            'class', 'style', 'href', 'src', 'alt', 'title',
            'colspan', 'rowspan'
        ],
        ALLOW_DATA_ATTR: false
    })

    return <div dangerouslySetInnerHTML={{ __html: sanitized }} />
}
```

### Dependencies
```bash
pnpm add dompurify
pnpm add -D @types/dompurify
```

### wag-mcp Usage
```typescript
wag_send_message(
    role: "pm",
    type: "chat",
    content: "<table><tr><th>Feature</th><th>Status</th></tr>...</table>",
    contentType: "html"
)
```

### What DOMPurify Strips
- `<script>` tags
- `onclick`, `onerror`, `onload` etc. event handlers
- `javascript:` URLs
- `<iframe>`, `<object>`, `<embed>`
- `<form>` and form elements
- Any tag/attribute not in allowlist

### What Still Works
- Layout: divs, spans, tables
- Text formatting: bold, italic, headings
- Lists: ul, ol, li
- Links: `<a href="...">` (http/https only)
- Images: `<img src="...">` (http/https only)
- Inline styles: `style="color: red; font-size: 14px"`

## UI Requirements

### Styling
- HTML content inherits base wagui styles
- Can be overridden with inline styles
- Tables get basic border/padding styling by default

### Security Indicators (Optional)
- Could show a small icon indicating "HTML content"
- Helps user know this message was explicitly HTML-typed

## Future Enhancements
- **Sandboxed iframe mode** - For trusted sources that need JS
- **Component library** - Predefined safe interactive components
- **Style scoping** - Prevent HTML styles from leaking to parent

## Priority
P3 - Nice to have, extends PBI-019

## Dependencies
- PBI-019 (Smart Content Rendering) - provides the content type framework

## Estimate
Small - single renderer, DOMPurify integration
